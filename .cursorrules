# Tricordarr (React Native, TypeScript)

## RefreshControl

- ALWAYS use `useRefresh` (`src/Hooks/useRefresh.ts`)
- NEVER use React Query `isFetching` with RefreshControl
- ALWAYS use `AppRefreshControl`
- `isFetching*` flags are NOT for RefreshControl
  - `isLoading` → initial empty load
  - `isRefetching` → background refetch
  - `isFetchingNext/PreviousPage` → pagination only

## API

- Swiftarr API dates are ISO8601 strings

## Clipboard

- Use `useClipboard()` for iOS feedback

## Structure

- Components: `src/Components`
- Screens: `src/Screens`
- Queries: `src/Queries`
- Hooks: `src/Hooks`
- Context: `src/Context`

## Debugging

- iOS localhost: `127.0.0.1`
- Android emulator: `10.0.2.2`
- `adb reverse` may be required offline

## Help Screens

- Use `HelpTopicView` / `HelpChapterTitleView`
- Link new screens in `HelpManualScreen.tsx`
- Include “Actions” (exclude Back)
- Privileged actions → “Privileged Actions”
- FABs:
  - Listed before Actions
  - `BaseFAB` → HelpTopicView(s)
  - `BaseFABGroup` → one HelpTopicView per action
  - Implement matching `HelpFABView`
- Swipe / selection behavior must be documented
- Add to `HelpScreenComponents`
- `ScrollingContentView`: `isStack={true}`, `overScroll={true}`

## Screen Wrapping

Default pattern:
LoggedInScreen

- PreRegistrationScreen(helpScreen)
- DisabledFeatureScreen(feature)
- ScreenInner

## Platform

- Use `src/Libraries/Platform/Detection.ts`

## Menus (Actions Menus)

- Visibility: `useMenu`
- Anchor: `MenuAnchor`
- Mutating items: call `onClose` in mutation `onSettled`
- Toggle / Navigation items: NO `onClose`
- Action items (e.g. Share): MUST provide `onClose`

## Queries / Mutations

- Invalidate via `getCacheKeys()`
- NEVER hardcode query keys

## Code Smells

- NEVER disable ESLint validation such as `eslint-disable-next-line react-hooks/exhaustive-deps`

## Lists

- Implementors of `BaseSwipeable.tsx` must have a `key`

## Logging

Use `createLogger` rather than `console.log`

## Reducers

- Never mutate state within a reducer

## Components

- Components must be pure

## Hooks

- No conditional hooks
- No new namespaces in `ControllerStructs.tsx`. New hooks named after the struct. `FezData` => `useFezData`
