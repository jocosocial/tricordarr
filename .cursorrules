# Tricordarr Project Context

This is a React Native app - a Twitarr client built with TypeScript.

## Refresh Control

**Always use the `useRefresh` hook for managing refreshing state with RefreshControl.**

The `useRefresh` hook (located at `src/Hooks/useRefresh.ts`) should be used for all pull-to-refresh functionality. Do NOT use `isFetching` from React Query queries directly with RefreshControl.

### Why?
Background refetches (e.g., from `NotificationDataPoller` polling every 2 minutes) will cause `isFetching` to toggle, making the RefreshControl spinner appear/disappear quickly and causing screen jumping on iOS. The `useRefresh` hook ensures the spinner only shows during user-initiated pull-to-refresh actions.

### Usage:
```ts
const {refreshing, setRefreshing, onRefresh} = useRefresh({
  refresh: refetch, // Can pass React Query refetch directly
  isRefreshing: isFetching, // optional external signal
});

// Use with AppRefreshControl
<AppRefreshControl refreshing={refreshing} onRefresh={onRefresh} />
```

### React Query State Usage:
- `isLoading`: no cache and in flight â†’ Return `<LoadingView />`
- `isRefetching`: Background refetch (excluding initial) and `refetch()`
- `isFetching`: Catchall for any time the query function is running. Use for debugging or other non-UI purposes, NOT for RefreshControl
- `isFetchingNextPage`/`isFetchingPreviousPage`: Only for pagination indicators, NOT RefreshControl
- Always use `useRefresh` hook for all `RefreshControl` components

## RefreshControl Component

React Native (as of 0.82+) `RefreshControl` does not support `enabled` on iOS. Always use `AppRefreshControl` from `src/Components/Controls/AppRefreshControl.tsx` which returns null when disabled (an AI-recommended pattern).

## API Details
- All dates from the Swiftarr API come in as ISO8601 strings

## Clipboard
iOS doesn't provide clipboard feedback. Use the `useClipboard()` hook from `src/Hooks/useClipboard.ts` which provides feedback.

## Project Structure
- Components are in `src/Components/`
- Screens are in `src/Screens/`
- Queries are in `src/Queries/`
- Hooks are in `src/Hooks/`
- Context is in `src/Context/`

## Cursor Debugging

To POST logs to the Cursor log listener different endpoints may be needed based on the platform. iOS can use `127.0.0.1`. Android should use `10.0.2.2`. Optionally prompt the user perform an `adb reverse` port mapping prior to testing during offline/airplane mode.

## Help Screens
Help screens should have a section for "Actions" if there are buttons within the header, either within a menu or directly. The back button should not be included unless it has very special properties (such as `SiteUIScreenBase.tsx`). Actions should be listed in order of header then within any menus. There does not need to be a help entry for the actions menu itself. If there is a button for Help, it should be last.

All help content should be implemented using `HelpTopicView` or `HelpChapterTitleView`. There are some exceptions to this such as in `ScheduleHelpScreen`.

Buttons that are used in multiple screens such as Help or Share should have re-usable components for their help entry (such as `HelpButtonHelpTopicView.tsx` or `ShareButtonHelpTopicView.tsx`). 

Newly created Help screens should be linked within the `HelpManualScreen.tsx`.

Any FABs should generally have their own `HelpChapterTitleView` and describe what they do. If it's a `BaseFAB` component it should implement one or more `HelpTopicView`. A `BaseFABGroup` should implement one `HelpTopicView` for each action within the FAB Group. The FABs should be listed before the Actions in the help screen. The actual FAB (be it a `BaseFABGroup` or `BaseFAB`) should implement a `HelpFABView` that matches the label and icon of the FAB.

All help screens should be added to the `HelpScreenComponents` type union.

## Screen Structure
Most screens should be wrapped in `LoggedInScreen`, `PreRegistrationScreen`, and `DisabledFeatureScreen` checkpoints. A relevant `helpScreen` should be provided to `PreRegistrationScreen`. An appropriate `SwiftarrFeature` to `DisabledFeatureScreen`.

Example:
```ts
<LoggedInScreen>
  <PreRegistrationScreen helpScreen={CommonStackComponents.photostreamHelpScreen}>
    <DisabledFeatureScreen feature={SwiftarrFeature.photostream}>
      <PhotostreamScreenInner {...props} />
    </DisabledFeatureScreen>
  </PreRegistrationScreen>
</LoggedInScreen>
```